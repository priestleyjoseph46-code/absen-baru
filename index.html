<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#4F46E5" />
  <title>Sistem Absensi Online</title>

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FontAwesome CDN -->
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
  />

  <style>
    .fade-in {
      animation: fadeIn 0.5s ease-in forwards;
      opacity: 0;
    }
    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
      from {
        opacity: 0;
        transform: translateY(20px);
      }
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 min-h-screen">

  <!-- Login Screen -->
  <div id="loginScreen" class="flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in"
      style="opacity:1; transform:none;"
    >
      <div class="text-center mb-8">
        <div
          class="bg-gradient-to-r from-blue-600 to-purple-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"
          aria-hidden="true"
        >
          <i class="fas fa-fingerprint text-white text-3xl"></i>
        </div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Sistem Absensi</h1>
        <p class="text-gray-600">Masuk untuk melakukan absensi</p>
      </div>

      <form id="loginForm" class="space-y-6">
        <div>
          <label for="username" class="block text-sm font-medium text-gray-700 mb-2">Username/ID</label>
          <input
            type="text"
            id="username"
            autocomplete="username"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Masukkan username atau ID"
            aria-describedby="username-error"
          />
          <p id="username-error" class="text-red-600 text-sm mt-1 hidden"></p>
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input
            type="password"
            id="password"
            autocomplete="current-password"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="Masukkan password"
            aria-describedby="password-error"
          />
          <p id="password-error" class="text-red-600 text-sm mt-1 hidden"></p>
        </div>

        <button
          type="submit"
          aria-label="Login"
          class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
        >
          <i class="fas fa-sign-in-alt mr-2"></i>Masuk
        </button>
      </form>

      <div class="mt-6 text-center">
        <button
          id="adminLoginBtn"
          class="text-blue-600 hover:text-blue-800 text-sm font-medium focus:outline-none focus:underline"
          aria-label="Login sebagai Administrator"
        >
          <i class="fas fa-user-shield mr-1"></i>Login sebagai Administrator
        </button>
      </div>

      <div
        id="loginError"
        role="alert"
        class="text-red-600 mt-4 text-center text-sm hidden"
      ></div>
    </div>
  </div>

  <!-- User Dashboard -->
  <div id="userDashboard" class="hidden min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
      <!-- Header -->
      <header
        class="bg-white rounded-2xl shadow-xl p-6 mb-6 flex justify-between items-center fade-in"
        style="opacity:1;"
      >
        <div class="flex items-center space-x-4">
          <div
            class="bg-gradient-to-r from-green-500 to-blue-500 w-16 h-16 rounded-full flex items-center justify-center"
            aria-hidden="true"
          >
            <i class="fas fa-user text-white text-2xl"></i>
          </div>
          <div>
            <h2 id="userName" class="text-2xl font-bold text-gray-800"></h2>
            <p id="userID" class="text-gray-600"></p>
          </div>
        </div>
        <button
          id="logoutBtn"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
          aria-label="Logout"
        >
          <i class="fas fa-sign-out-alt mr-2"></i>Keluar
        </button>
      </header>

      <!-- Shift Selection -->
      <section
        class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in"
        style="opacity:1;"
        aria-label="Pilih Shift Kerja"
      >
        <h3 class="text-xl font-bold text-gray-800 mb-4">
          <i class="fas fa-clock mr-2 text-blue-600"></i>Pilih Shift Kerja
        </h3>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" role="radiogroup" aria-labelledby="shiftSelectionLabel">
          <button
            type="button"
            class="shift-btn bg-blue-100 hover:bg-blue-200 text-blue-800 py-3 px-4 rounded-lg font-semibold transition duration-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
            data-shift="1"
            role="radio"
            aria-checked="false"
            tabindex="0"
          >
            <i class="fas fa-sun mr-2"></i>Shift 1<br /><small>07:00-15:00</small>
          </button>
          <button
            type="button"
            class="shift-btn bg-orange-100 hover:bg-orange-200 text-orange-800 py-3 px-4 rounded-lg font-semibold transition duration-300 focus:outline-none focus:ring-2 focus:ring-orange-500"
            data-shift="2"
            role="radio"
            aria-checked="false"
            tabindex="-1"
          >
            <i class="fas fa-sun mr-2"></i>Shift 2<br /><small>15:00-23:00</small>
          </button>
          <button
            type="button"
            class="shift-btn bg-purple-100 hover:bg-purple-200 text-purple-800 py-3 px-4 rounded-lg font-semibold transition duration-300 focus:outline-none focus:ring-2 focus:ring-purple-500"
            data-shift="3"
            role="radio"
            aria-checked="false"
            tabindex="-1"
          >
            <i class="fas fa-moon mr-2"></i>Shift 3<br /><small>23:00-07:00</small>
          </button>
          <button
            type="button"
            class="shift-btn bg-green-100 hover:bg-green-200 text-green-800 py-3 px-4 rounded-lg font-semibold transition duration-300 focus:outline-none focus:ring-2 focus:ring-green-500"
            data-shift="4"
            role="radio"
            aria-checked="false"
            tabindex="-1"
          >
            <i class="fas fa-clock mr-2"></i>Shift 4<br /><small>Fleksibel</small>
          </button>
        </div>
        <p class="text-center text-gray-600 mt-4" aria-live="polite">
          Shift yang dipilih: <span id="selectedShift" class="font-semibold text-blue-600">Belum dipilih</span>
        </p>
      </section>

      <!-- Attendance Buttons -->
      <section class="grid md:grid-cols-2 gap-6 mb-6">
        <div
          class="bg-white rounded-2xl shadow-xl p-8 text-center fade-in"
          style="opacity:1;"
          aria-label="Absen masuk kerja"
        >
          <div class="mb-6">
            <div
              class="bg-green-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4"
              aria-hidden="true"
            >
              <i class="fas fa-sign-in-alt text-green-600 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Finger In</h3>
            <p class="text-gray-600">Absen masuk kerja</p>
          </div>
          <button
            id="fingerInBtn"
            class="w-full bg-green-500 hover:bg-green-600 text-white py-4 rounded-xl font-semibold text-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-green-400"
            disabled
            aria-disabled="true"
            aria-label="Finger In"
            type="button"
          >
            <i class="fas fa-fingerprint mr-2"></i>FINGER IN
          </button>
          <p id="fingerInTime" class="text-sm text-gray-500 mt-2" aria-live="polite"></p>
        </div>

        <div
          class="bg-white rounded-2xl shadow-xl p-8 text-center fade-in"
          style="opacity:1;"
          aria-label="Absen pulang kerja"
        >
          <div class="mb-6">
            <div
              class="bg-red-100 w-24 h-24 rounded-full flex items-center justify-center mx-auto mb-4"
              aria-hidden="true"
            >
              <i class="fas fa-sign-out-alt text-red-600 text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Finger Out</h3>
            <p class="text-gray-600">Absen pulang kerja</p>
          </div>
          <button
            id="fingerOutBtn"
            class="w-full bg-red-500 hover:bg-red-600 text-white py-4 rounded-xl font-semibold text-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-red-400"
            disabled
            aria-disabled="true"
            aria-label="Finger Out"
            type="button"
          >
            <i class="fas fa-fingerprint mr-2"></i>FINGER OUT
          </button>
          <p id="fingerOutTime" class="text-sm text-gray-500 mt-2" aria-live="polite"></p>
        </div>
      </section>

      <!-- Today's Status -->
      <section
        class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in"
        style="opacity:1;"
        aria-label="Status hari ini"
      >
        <h3 class="text-xl font-bold text-gray-800 mb-4">
          <i class="fas fa-calendar-day mr-2 text-blue-600"></i>Status Hari Ini
        </h3>
        <div class="grid md:grid-cols-4 gap-4">
          <div class="bg-blue-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">Tanggal</p>
            <p id="todayDate" class="font-semibold text-gray-800"></p>
          </div>
          <div class="bg-green-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">Waktu Masuk</p>
            <p id="todayIn" class="font-semibold text-green-600">-</p>
          </div>
          <div class="bg-red-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">Waktu Keluar</p>
            <p id="todayOut" class="font-semibold text-red-600">-</p>
          </div>
          <div class="bg-purple-50 p-4 rounded-lg">
            <p class="text-sm text-gray-600">Shift</p>
            <p id="todayShift" class="font-semibold text-purple-600">-</p>
          </div>
        </div>
      </section>

      <!-- Weekly Hours Summary -->
      <section
        class="bg-white rounded-2xl shadow-xl p-6 mb-6 fade-in"
        style="opacity:1;"
        aria-label="Ringkasan jam kerja mingguan"
      >
        <h3 class="text-xl font-bold text-gray-800 mb-4">
          <i class="fas fa-chart-bar mr-2 text-purple-600"></i>Ringkasan Jam Kerja Minggu Ini
        </h3>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Weekly Summary -->
          <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-semibold text-gray-800">Total Jam Kerja</h4>
              <i class="fas fa-clock text-purple-600 text-xl"></i>
            </div>
            <div class="space-y-3">
              <div class="flex justify-between">
                <span class="text-gray-600">Minggu Ini:</span>
                <span id="weeklyHours" class="font-bold text-purple-600 text-lg">0 jam 0 menit</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Hari Kerja:</span>
                <span id="workingDays" class="font-semibold text-gray-800">0 hari</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Rata-rata/Hari:</span>
                <span id="averageHours" class="font-semibold text-gray-800">0 jam 0 menit</span>
              </div>
            </div>
          </div>

          <!-- Daily Breakdown -->
          <div class="bg-gradient-to-r from-green-50 to-teal-50 p-6 rounded-xl" aria-live="polite" aria-atomic="true">
            <div class="flex items-center justify-between mb-4">
              <h4 class="font-semibold text-gray-800">Rincian Harian</h4>
              <i class="fas fa-calendar-week text-green-600 text-xl"></i>
            </div>
            <div class="space-y-2" id="dailyBreakdown">
              <!-- Daily hours populated here -->
            </div>
          </div>
        </div>

        <!-- Progress Bar -->
        <div class="mt-6">
          <div class="flex justify-between text-sm text-gray-600 mb-2" aria-label="Progress target mingguan">
            <span>Target Mingguan (40 jam)</span>
            <span id="progressPercentage">0%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div
              id="progressBar"
              class="bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-500"
              style="width: 0%"
            ></div>
          </div>
        </div>
      </section>

      <!-- Send to Spreadsheet -->
      <section
        class="bg-white rounded-2xl shadow-xl p-6 fade-in"
        style="opacity:1;"
        aria-label="Kirim data absensi ke spreadsheet"
      >
        <h3 class="text-xl font-bold text-gray-800 mb-4">
          <i class="fas fa-table mr-2 text-green-600"></i>Kirim Data Absensi
        </h3>
        <p class="text-gray-600 mb-4">Kirim data absensi Anda ke spreadsheet untuk pencatatan resmi</p>
        <button
          id="sendToSpreadsheetBtn"
          class="w-full bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white py-4 rounded-xl font-semibold text-lg transition duration-300 focus:outline-none focus:ring-2 focus:ring-green-400"
          aria-label="Kirim data ke spreadsheet"
          type="button"
        >
          <i class="fas fa-paper-plane mr-2"></i>KIRIM KE SPREADSHEET
        </button>
        <p
          id="sendStatus"
          class="text-center text-sm mt-3"
          role="status"
          aria-live="polite"
        ></p>
      </section>
    </div>
  </div>

  <!-- Admin Dashboard - similar structure, omitted for brevity, but follow the same style and accessibility -->

<script>
  // Employee Data (Consider backend for security in production)
  const employees = {
    "0001": { name: "Joseph Preistley", password: "0001" },
    "0002": { name: "panda Reyez", password: "0002" },
    // ... dst
  };

  // State variables
  let currentUser = null;
  let selectedShift = null;
  let attendanceData = {};
  let spreadsheetData = {};

  // Load from localStorage safely
  function loadLocalData() {
    try {
      attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || {};
    } catch (e) {
      console.error("Gagal membaca attendanceData:", e);
      attendanceData = {};
    }

    try {
      spreadsheetData = JSON.parse(localStorage.getItem('spreadsheetData')) || {};
    } catch (e) {
      console.error("Gagal membaca spreadsheetData:", e);
      spreadsheetData = {};
    }
  }

  function saveLocalData() {
    try {
      localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
    } catch (e) {
      console.error("Gagal menyimpan attendanceData:", e);
    }
  }

  function saveLocalSpreadsheetData() {
    try {
      localStorage.setItem('spreadsheetData', JSON.stringify(spreadsheetData));
    } catch (e) {
      console.error("Gagal menyimpan spreadsheetData:", e);
    }
  }

  // Initialize and bind events
  document.addEventListener('DOMContentLoaded', () => {
    loadLocalData();
    updateTodayDate();
    initializeShiftButtons();
    setupLoginForm();
    setupAdminLoginBtn();
    setupFingerButtons();
    setupSendToSpreadsheet();
    setupLogoutButtons();

    // If any user session existed, you can implement session restore here
  });

  // Viewport and date helpers
  function updateTodayDate() {
    const today = new Date();
    document.getElementById('todayDate').textContent = today.toLocaleDateString('id-ID', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }

  // Shift Buttons Initialization
  function initializeShiftButtons() {
    const shiftButtons = document.querySelectorAll('.shift-btn');
    shiftButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        // Remove aria-checked and styling from all
        shiftButtons.forEach((b) => {
          b.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-200');
          b.setAttribute('aria-checked', 'false');
          b.setAttribute('tabindex', '-1');
        });

        btn.classList.add('ring-2', 'ring-blue-500', 'bg-blue-200');
        btn.setAttribute('aria-checked', 'true');
        btn.setAttribute('tabindex', '0');
        btn.focus();

        selectedShift = btn.dataset.shift;
        document.getElementById('selectedShift').textContent = `Shift ${selectedShift}`;

        enableFingerButtons();
      });
    });
  }

  // Enable Finger In/Out buttons
  function enableFingerButtons() {
    const fingerInBtn = document.getElementById('fingerInBtn');
    const fingerOutBtn = document.getElementById('fingerOutBtn');
    fingerInBtn.disabled = false;
    fingerOutBtn.disabled = false;
    fingerInBtn.setAttribute('aria-disabled', 'false');
    fingerOutBtn.setAttribute('aria-disabled', 'false');
  }

  // Setup Login Form
  function setupLoginForm() {
    const loginForm = document.getElementById('loginForm');
    const loginError = document.getElementById('loginError');

    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      loginError.classList.add('hidden');
      loginError.textContent = '';

      if (!username || !password) {
        showLoginError('Username dan password tidak boleh kosong');
        return;
      }

      if (employees[username] && employees[username].password === password) {
        currentUser = { id: username, name: employees[username].name };
        showUserDashboard();
      } else {
        showLoginError('Username atau password salah!');
      }
    });

    function showLoginError(message) {
      loginError.textContent = message;
      loginError.classList.remove('hidden');
      document.getElementById('password').value = '';
      document.getElementById('password').focus();
    }
  }

  // Admin Login Button Setup
  function setupAdminLoginBtn() {
    const adminBtn = document.getElementById('adminLoginBtn');
    adminBtn.addEventListener('click', () => {
      // Simple prompt (should be secured) - recommend backend
      const adminPass = prompt('Masukkan password administrator:');
      if (adminPass === 'admin123') {
        showAdminDashboard();
      } else {
        alert('Password administrator salah!');
      }
    });
  }

  // Show user dashboard
  function showUserDashboard() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('userDashboard').classList.remove('hidden');
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userID').textContent = `ID: ${currentUser.id}`;
    updateUserStatus();
  }

  // Show admin dashboard (similar pattern)
  function showAdminDashboard() {
    alert('Dashboard Admin belum difokuskan di revisi ini. Silakan sesuaikan mirip prinsip dashboard user.');
    // Implement sesuai kode asli atau revisi sesuai kebutuhan
  }

  function setupFingerButtons() {
    const fingerInBtn = document.getElementById('fingerInBtn');
    const fingerOutBtn = document.getElementById('fingerOutBtn');

    fingerInBtn.addEventListener('click', () => {
      if (!selectedShift) {
        alert('Silakan pilih shift terlebih dahulu!');
        return;
      }

      const now = new Date();
      const today = now.toISOString().split('T')[0];

      attendanceData[currentUser.id] = attendanceData[currentUser.id] || {};
      attendanceData[currentUser.id][today] = attendanceData[currentUser.id][today] || {};

      if (attendanceData[currentUser.id][today].in) {
        alert('Anda sudah melakukan finger in hari ini!');
        return;
      }

      attendanceData[currentUser.id][today].in = now.toLocaleTimeString('id-ID');
      attendanceData[currentUser.id][today].name = currentUser.name;
      attendanceData[currentUser.id][today].shift = selectedShift;

      saveLocalData();

      showToast(`Finger In berhasil untuk Shift ${selectedShift}!`);
      updateUserStatus();
    });

    fingerOutBtn.addEventListener('click', () => {
      if (!selectedShift) {
        alert('Silakan pilih shift terlebih dahulu!');
        return;
      }

      const now = new Date();
      const today = now.toISOString().split('T')[0];

      if (!(attendanceData[currentUser.id] && attendanceData[currentUser.id][today] && attendanceData[currentUser.id][today].in)) {
        alert('Anda harus melakukan finger in terlebih dahulu!');
        return;
      }

      if (attendanceData[currentUser.id][today].out) {
        alert('Anda sudah melakukan finger out hari ini!');
        return;
      }

      attendanceData[currentUser.id][today].out = now.toLocaleTimeString('id-ID');

      saveLocalData();

      showToast(`Finger Out berhasil untuk Shift ${selectedShift}!`);
      updateUserStatus();
    });
  }

  // Update user status UI
  function updateUserStatus() {
    if (!currentUser) return;
    const today = new Date().toISOString().split('T')[0];
    const todayData = attendanceData[currentUser.id] && attendanceData[currentUser.id][today];

    if (todayData) {
      document.getElementById('todayIn').textContent = todayData.in || '-';
      document.getElementById('todayOut').textContent = todayData.out || '-';
      document.getElementById('todayShift').textContent = todayData.shift ? `Shift ${todayData.shift}` : '-';

      document.getElementById('fingerInTime').textContent = todayData.in ? `Masuk: ${todayData.in}` : '';
      document.getElementById('fingerOutTime').textContent = todayData.out ? `Keluar: ${todayData.out}` : '';

      if (todayData.shift) {
        selectedShift = todayData.shift;
        document.getElementById('selectedShift').textContent = `Shift ${selectedShift}`;

        // Highlight shift button
        const shiftButtons = document.querySelectorAll('.shift-btn');
        shiftButtons.forEach((btn) => {
          btn.classList.remove('ring-2', 'ring-blue-500', 'bg-blue-200');
          btn.setAttribute('aria-checked', 'false');
          if (btn.dataset.shift === selectedShift) {
            btn.classList.add('ring-2', 'ring-blue-500', 'bg-blue-200');
            btn.setAttribute('aria-checked', 'true');
          }
        });

        enableFingerButtons();
      }
    } else {
      document.getElementById('todayIn').textContent = '-';
      document.getElementById('todayOut').textContent = '-';
      document.getElementById('todayShift').textContent = '-';
      document.getElementById('fingerInTime').textContent = '';
      document.getElementById('fingerOutTime').textContent = '';
    }

    updateWeeklyHoursSummary();
  }

  // Weekly hours summary calculation and UI update
  function updateWeeklyHoursSummary() {
    if (!currentUser) return;

    const weekDates = getWeekDates();
    let totalMinutes = 0;
    let workingDays = 0;
    const dailyHours = [];

    weekDates.forEach((date) => {
      const dateStr = date.toISOString().split('T')[0];
      const dayData = attendanceData[currentUser.id] && attendanceData[currentUser.id][dateStr];

      const dayName = date.toLocaleDateString('id-ID', { weekday: 'short' });
      const dayDate = date.getDate();

      if (dayData && dayData.in && dayData.out) {
        const minutes = calculateDurationInMinutes(dayData.in, dayData.out);
        totalMinutes += minutes;
        workingDays++;

        const hours = Math.floor(minutes / 60);
        const mins = minutes % 60;
        dailyHours.push({
          day: `${dayName}, ${dayDate}`,
          duration: `${hours}j ${mins}m`,
          hasData: true,
        });
      } else if (dayData && dayData.in) {
        dailyHours.push({
          day: `${dayName}, ${dayDate}`,
          duration: 'Belum keluar',
          hasData: true,
        });
      } else {
        dailyHours.push({
          day: `${dayName}, ${dayDate}`,
          duration: '-',
          hasData: false,
        });
      }
    });

    const totalHours = Math.floor(totalMinutes / 60);
    const totalMins = totalMinutes % 60;
    document.getElementById('weeklyHours').textContent = `${totalHours} jam ${totalMins} menit`;
    document.getElementById('workingDays').textContent = `${workingDays} hari`;

    if (workingDays > 0) {
      const avgMinutes = Math.floor(totalMinutes / workingDays);
      const avgHours = Math.floor(avgMinutes / 60);
      const avgMins = avgMinutes % 60;
      document.getElementById('averageHours').textContent = `${avgHours} jam ${avgMins} menit`;
    } else {
      document.getElementById('averageHours').textContent = '0 jam 0 menit';
    }

    const progressPercentage = Math.min((totalMinutes / 2400) * 100, 100);
    document.getElementById('progressPercentage').textContent = `${Math.round(progressPercentage)}%`;
    document.getElementById('progressBar').style.width = `${progressPercentage}%`;

    const dailyBreakdown = document.getElementById('dailyBreakdown');
    dailyBreakdown.innerHTML = '';

    dailyHours.forEach((day) => {
      const dayElement = document.createElement('div');
      dayElement.className = 'flex justify-between text-sm';

      const textColor = day.hasData ? 'text-gray-800' : 'text-gray-400';
      const durationColor =
        day.duration === 'Belum keluar'
          ? 'text-orange-600'
          : day.duration === '-'
          ? 'text-gray-400'
          : 'text-green-600';

      dayElement.innerHTML = `
        <span class="${textColor}">${day.day}</span>
        <span class="font-semibold ${durationColor}">${day.duration}</span>
      `;

      dailyBreakdown.appendChild(dayElement);
    });
  }

  // Helper to get current week Monday to Sunday dates
  function getWeekDates() {
    const today = new Date();
    const currentDay = today.getDay() || 7; // Make Sunday (0) = 7
    const monday = new Date(today);
    monday.setDate(today.getDate() - currentDay + 1);

    const dates = [];
    for (let i = 0; i < 7; i++) {
      const date = new Date(monday);
      date.setDate(monday.getDate() + i);
      dates.push(date);
    }
    return dates;
  }

  // Calculate duration in minutes between inTime and outTime (hh:mm:ss)
  function calculateDurationInMinutes(inTime,
